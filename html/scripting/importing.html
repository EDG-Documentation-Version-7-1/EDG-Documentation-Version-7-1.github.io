<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Importing Data with ADS &mdash; edg-documentation 7.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" type="text/css" />
      <link rel="stylesheet" href="../_static/./_css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with Relational Databases via SQL" href="sql.html" />
    <link rel="prev" title="The Scripting User Interface" href="ui.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/EDG-logo.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/index.html">Introduction to EDG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start_guides/index.html">Quick Start Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrading_topbraid_edg/index.html">Upgrades and Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installing_sample_data/index.html">Installing Sample Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administrator_guide/index.html">Administrator Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topbraid_edg_studio/index.html">TopBraid EDG Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../graphql/index.html">GraphQL</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Scripting with JavaScript and ADS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction to ADS</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui.html">The Scripting User Interface</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Importing Data with ADS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#working-with-uploaded-files">Working with Uploaded Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#downloading-files-via-http">Downloading Files via HTTP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-json">Importing JSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-spreadsheets">Importing Spreadsheets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bulk-loader-for-spreadsheets">Bulk Loader for Spreadsheets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#streaming-loader-for-spreadsheets">Streaming Loader for Spreadsheets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#importing-xml">Importing XML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#importing-relational-databases-via-sql">Importing Relational Databases via SQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sql.html">Working with Relational Databases via SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="actions.html">Resource Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html">ADS-based Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="shacl.html">Using ADS with SHACL</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodejs.html">Using ADS from Node.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html">Using ADS from Web Applications and React</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ext/index.html">Extension Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs/index.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/index.html">TopQuadrant EDG Support</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">edg-documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Scripting with JavaScript and ADS</a> &raquo;</li>
      <li>Importing Data with ADS</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div></div></blockquote>
<section id="importing-data-with-ads">
<span id="scripting-importing"></span><h1>Importing Data with ADS<a class="headerlink" href="#importing-data-with-ads" title="Permalink to this headline"></a></h1>
<p>It is very common for data graphs to be populated from external files - Spreadsheets, XML, JSON etc.
Users may need to upload files or files may originate from web services and are downloaded for processing.
The content of these non-RDF files shall be transformed into RDF triples, typically in a given ontology.
This section introduces how Active Data Shapes and SHACL can be used to facilitate such import processes.</p>
<p>Standard JavaScript/ECMAScript provides all commonly needed operations for complex data processing.
The missing bits, on how to load data from various data sources and formats, are covered by the following subsections.</p>
<p>The <a class="reference internal" href="ui.html#scripting-script-editor-panel"><span class="std std-ref">Script Editor Panel</span></a> is a good place to write importer scripts.
Once you are happy with your importer scripts, you may want to turn them into <a class="reference internal" href="actions.html#scripting-actions"><span class="std std-ref">Resource Actions</span></a>, <a class="reference internal" href="services.html#scripting-services"><span class="std std-ref">ADS-based Web Services</span></a> or <a class="reference internal" href="../ext/points.html#ext-scheduled-jobs"><span class="std std-ref">Scheduled Jobs</span></a> that can be invoked repeatedly as batch operations.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The section <a class="reference internal" href="actions.html#scripting-actions-import"><span class="std std-ref">Custom Import Script Example</span></a> shows a worked out example of how to create an importer that can be launched from the Modify menu.</p>
</div>
<section id="working-with-uploaded-files">
<span id="scripting-uploaded-files"></span><h2>Working with Uploaded Files<a class="headerlink" href="#working-with-uploaded-files" title="Permalink to this headline"></a></h2>
<p>The easiest way to get started with this technology is by trying it out, here with the Script Editor panel.
This panel has a button to upload any file to the server, so that the file can be processed by a script:</p>
<figure class="align-center" id="id1">
<img alt="The File Upload button of the Script Editor panel" class="edg-figure" src="../_images/FileUploadButton.png" />
<figcaption>
<p><span class="caption-text"><strong>The Script Editor panel can be used to upload files and then query the content of those files</strong></span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>You can incrementally develop your importer script by trying it out, especially using the Preview button:</p>
<figure class="align-center" id="id2">
<img alt="The Preview button can be used" class="edg-figure" src="../_images/FileUploadPreview.png" />
<figcaption>
<p><span class="caption-text"><strong>The Script Editor panel can be used to upload files and then query the content of those files</strong></span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If you don’t see the Preview button, see <a class="reference internal" href="ui.html#scripting-readonlymode"><span class="std std-ref">Read-only mode versus Read/write mode</span></a>.</p>
</div>
<p>Files that have been uploaded will go into a temporary folder on the server from which they will be removed once they are no longer needed.
They are discarded if they haven’t been accessed for more than an hour.
Scripts can access those files using a provided file identifier, which in the Script Panel from the example above is automatically called <code class="code docutils literal notranslate"><span class="pre">file</span></code>.
The built-in function <code class="code docutils literal notranslate"><span class="pre">graph.uploadedFile(file)</span></code> can then be used to return an instance of the JavaScript class <code class="code docutils literal notranslate"><span class="pre">UploadedFile</span></code> which provides further functions to produce a spreadsheet object, an XML object etc.</p>
<p>For example, use <code class="code docutils literal notranslate"><span class="pre">graph.uploadedFile(file).text</span></code> to get the full content from the file as a string.
Your script can then proceed with whatever it like wants to do with that file content, for example produce new instances for each row of a spreadsheet.</p>
</section>
<section id="downloading-files-via-http">
<span id="scripting-importing-http"></span><h2>Downloading Files via HTTP<a class="headerlink" href="#downloading-files-via-http" title="Permalink to this headline"></a></h2>
<p>Files can also be downloaded through HTTP requests.
The entry point is the function <code class="code docutils literal notranslate"><span class="pre">IO.http()`</span></code> which performs arbitrary HTTP requests and either returns the response data to the program or saves the file as an “uploaded” file so that it can be processed further.</p>
<p>The following example requests a tab-separated values spreadsheet from a server (here, it’s actually using a TopBraid SPARQL endpoint but that doesn’t matter).
The resulting spreadsheet is saved to a temp file which can be processed further by the script, for example to count the number of rows.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">let</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">IO</span><span class="p">.</span><span class="nx">http</span><span class="p">({</span>
<span class="linenos"> 2</span>    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://localhost:4500/tbl/sparql&#39;</span><span class="p">,</span>
<span class="linenos"> 3</span>    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
<span class="linenos"> 4</span>    <span class="nx">params</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos"> 5</span>        <span class="nx">query</span><span class="o">:</span> <span class="sb">`</span>
<span class="linenos"> 6</span><span class="sb">            SELECT *</span>
<span class="linenos"> 7</span><span class="sb">            WHERE {</span>
<span class="linenos"> 8</span><span class="sb">                GRAPH &lt;http://topbraid.org/examples/kennedys&gt; {</span>
<span class="linenos"> 9</span><span class="sb">                    ?person a &lt;http://topbraid.org/examples/kennedys#Person&gt; .</span>
<span class="linenos">10</span><span class="sb">                    ?person &lt;http://topbraid.org/examples/kennedys#birthYear&gt; ?birthYear .</span>
<span class="linenos">11</span><span class="sb">                }</span>
<span class="linenos">12</span><span class="sb">            } ORDER BY ?birthYear`</span>
<span class="linenos">13</span>    <span class="p">},</span>
<span class="linenos">14</span>    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
<span class="linenos">15</span>        <span class="nx">Accept</span><span class="o">:</span> <span class="s1">&#39;text/tab-separated-values&#39;</span>
<span class="linenos">16</span>    <span class="p">},</span>
<span class="linenos">17</span>    <span class="nx">toFileSuffix</span><span class="o">:</span> <span class="s1">&#39;tsv&#39;</span>
<span class="linenos">18</span><span class="p">})</span>
<span class="linenos">19</span><span class="nx">IO</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">file</span><span class="p">).</span><span class="nx">asSpreadsheet</span><span class="p">().</span><span class="nx">rows</span><span class="p">().</span><span class="nx">length</span>
</pre></div>
</div>
<p>As usual, you can explore the features of this API either in the Script Editor (via auto-complete etc) or on the API documentation pages.</p>
</section>
<section id="importing-json">
<span id="scripting-importing-json"></span><h2>Importing JSON<a class="headerlink" href="#importing-json" title="Permalink to this headline"></a></h2>
<p>Handling JSON files from JavaScript is very easy. You simply need to fetch the text content of the uploaded file and parse it, then query the JSON like any other JavaScript object:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kd">let</span> <span class="nx">u</span> <span class="o">=</span> <span class="nx">IO</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
<span class="linenos">2</span><span class="kd">let</span> <span class="nx">json</span> <span class="o">=</span> <span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
<span class="linenos">3</span><span class="nx">schema</span><span class="p">.</span><span class="nx">createPerson</span><span class="p">({</span>
<span class="linenos">4</span>	<span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://example.org/Person#&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">json</span><span class="p">.</span><span class="nx">lastName</span><span class="p">),</span>
<span class="linenos">5</span>	<span class="nx">givenName</span><span class="o">:</span> <span class="nx">json</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span>
<span class="linenos">6</span>	<span class="nx">familyName</span><span class="o">:</span> <span class="nx">json</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span>
<span class="linenos">7</span><span class="p">});</span>
</pre></div>
</div>
</section>
<section id="importing-spreadsheets">
<span id="scripting-importing-spreadsheets"></span><h2>Importing Spreadsheets<a class="headerlink" href="#importing-spreadsheets" title="Permalink to this headline"></a></h2>
<p>Spreadsheet files may be uploaded as either</p>
<ul class="simple">
<li><p>Tab-separated values (.tsv)</p></li>
<li><p>Comma-separated values (.csv)</p></li>
<li><p>Excel files (.xlsx)</p></li>
</ul>
<p>Two distinct APIs are provided to access the rows of those files:
One with a cell-based API that loads the whole spreadsheet in bulk, and an alternative streaming API for large files.</p>
<section id="bulk-loader-for-spreadsheets">
<h3>Bulk Loader for Spreadsheets<a class="headerlink" href="#bulk-loader-for-spreadsheets" title="Permalink to this headline"></a></h3>
<p>A unified API is provided to access the sheets, rows and columns of spreadsheets.
To get started, use <code class="code docutils literal notranslate"><span class="pre">.asSpreadsheet()</span></code> on the <code class="code docutils literal notranslate"><span class="pre">UploadedFile</span></code>.
This produces an object with functions to query all individual cells, the names of the columns, the rows and the sheet names.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Use auto-complete on <code class="code docutils literal notranslate"><span class="pre">IO.uploadedFile(file).asSpreadsheet()</span></code> to see the currently available API.</p>
</div>
<p>By default, all cell values will be strings.
However, for Excel files the system will produce JavaScript booleans (true and false) if the cell values are recognized booleans, and numbers will be converted to JavaScript numbers automatically.
Date cells will be converted to instances of <code class="code docutils literal notranslate"><span class="pre">LiteralNode</span></code>, i.e. you can use <code class="code docutils literal notranslate"><span class="pre">.lex`</span></code> to retrieve the lexical form of the date in XSD format.</p>
<p>A small example of all this uses a tab-separated file such as:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>City	Maori Name	Population	LatLong
<span class="linenos">2</span>Tauranga		135000	-37.683333 176.166667
<span class="linenos">3</span>Dunedin	Ōtepoti	104500	-45.866667 170.5
</pre></div>
</div>
<p>An example script to convert those rows into instances of the <code class="code docutils literal notranslate"><span class="pre">g:City</span></code> from the sample Geography Taxonomy is:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">IO</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">asSpreadsheet</span><span class="p">();</span>
<span class="linenos"> 2</span><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mf">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">rowCount</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 3</span>    <span class="kd">let</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">row</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="linenos"> 4</span>    <span class="kd">let</span> <span class="nx">city</span> <span class="o">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">createCity</span><span class="p">({</span>
<span class="linenos"> 5</span>        <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://topquadrant.com/ns/examples/geography#&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">City</span><span class="p">),</span>
<span class="linenos"> 6</span>        <span class="nx">prefLabel</span><span class="o">:</span> <span class="nx">row</span><span class="p">.</span><span class="nx">City</span><span class="p">,</span>
<span class="linenos"> 7</span>        <span class="nx">broader</span><span class="o">:</span> <span class="nx">focusNode</span><span class="p">,</span>
<span class="linenos"> 8</span>        <span class="nx">population</span><span class="o">:</span> <span class="nx">row</span><span class="p">.</span><span class="nx">Population</span><span class="p">,</span>
<span class="linenos"> 9</span>        <span class="nx">lat</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">LatLong</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]),</span>
<span class="linenos">10</span>        <span class="kr">long</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">LatLong</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">]),</span>
<span class="linenos">11</span>    <span class="p">})</span>
<span class="linenos">12</span>    <span class="kd">let</span> <span class="nx">maoriName</span> <span class="o">=</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;Maori Name&#39;</span><span class="p">];</span>
<span class="linenos">13</span>    <span class="k">if</span><span class="p">(</span><span class="nx">maoriName</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">14</span>        <span class="nx">city</span><span class="p">.</span><span class="nx">altLabel</span> <span class="o">=</span> <span class="nx">skosxl</span><span class="p">.</span><span class="nx">createLabel</span><span class="p">({</span>
<span class="linenos">15</span>            <span class="nx">literalForm</span><span class="o">:</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">langString</span><span class="p">(</span><span class="nx">maoriName</span><span class="p">,</span> <span class="s1">&#39;mi&#39;</span><span class="p">)</span>
<span class="linenos">16</span>        <span class="p">})</span>
<span class="linenos">17</span>    <span class="p">}</span>
<span class="linenos">18</span><span class="p">}</span>
</pre></div>
</div>
<p>Let’s walk through a couple of techniques used here.</p>
<p>The first line, <code class="code docutils literal notranslate"><span class="pre">let</span> <span class="pre">s</span> <span class="pre">=</span> <span class="pre">graph.uploadedFile(file).asSpreadsheet();</span></code> fetches an <code class="code docutils literal notranslate"><span class="pre">UploadedSpreadsheet</span></code> instance that we can then query to walk through the columns and rows.</p>
<p>The for loop walks each row individually.
In each loop, the line <code class="code docutils literal notranslate"><span class="pre">let</span> <span class="pre">row</span> <span class="pre">=</span> <span class="pre">s.row(i)</span></code> delivers a JavaScript object with one value for each column.
For example, if the column name is “City” then you can query the current value using <code class="code docutils literal notranslate"><span class="pre">row.City</span></code>.
For names that are not valid JavaScript identifiers, use the array-based syntax such as <code class="code docutils literal notranslate"><span class="pre">row['Maori</span> <span class="pre">Name']</span></code>.</p>
<p>An alternative technique (not shown here) to fetch values is through <code class="code docutils literal notranslate"><span class="pre">s.cell(rowIndex,</span> <span class="pre">colIndex)</span></code>.</p>
<p>Empty cells are not present so you would get <code class="code docutils literal notranslate"><span class="pre">null</span></code> or <code class="code docutils literal notranslate"><span class="pre">undefined</span></code> when you query them.
This means that in some cases you may want to insert guarding <code class="code docutils literal notranslate"><span class="pre">if</span></code> clauses such as <code class="code docutils literal notranslate"><span class="pre">if(maoriName)</span></code> above, or use the JavaScript ? operator to prevent null pointer exceptions.</p>
<p>The expression <code class="code docutils literal notranslate"><span class="pre">row.LatLong.split('</span> <span class="pre">')</span></code> turns the combined Lat/Long string into an array of two strings, separated by spaces.
You can use any number of pre-processing steps before assigning values here - the whole power of JavaScript string processing is at your disposal.</p>
<p>To assign values with the correct datatype, the SHACL shape definitions help you.
In the example above, the property <code class="code docutils literal notranslate"><span class="pre">g.population</span></code> has <code class="code docutils literal notranslate"><span class="pre">sh:datatype</span> <span class="pre">xsd:integer</span></code>.
Then although the value of <code class="code docutils literal notranslate"><span class="pre">row.Population</span></code> is a JavaScript string, the system will automatically cast it into an <code class="code docutils literal notranslate"><span class="pre">xsd:integer</span></code> literal as part of the assignment.
In the case of lat and long however, no single <code class="code docutils literal notranslate"><span class="pre">sh:datatype</span></code> constraint exists as the values may be either <code class="code docutils literal notranslate"><span class="pre">xsd:integer</span></code>, <code class="code docutils literal notranslate"><span class="pre">xsd:decimal</span></code> or <code class="code docutils literal notranslate"><span class="pre">xsd:double</span></code>.
It is therefore necessary to use the built-in <code class="code docutils literal notranslate"><span class="pre">parseFloat</span></code> function to produce a JavaScript number.
If you ever need to produce literals of specific datatypes, use something like <code class="code docutils literal notranslate"><span class="pre">graph.literal({</span> <span class="pre">lex:</span> <span class="pre">'42',</span> <span class="pre">datatype:</span> <span class="pre">xsd.double</span> <span class="pre">})</span></code>.</p>
<p>The line <code class="code docutils literal notranslate"><span class="pre">broader:</span> <span class="pre">focusNode</span></code> assigns the currently selected resource (such as the <code class="code docutils literal notranslate"><span class="pre">g:Country</span></code> of New Zealand) to the <code class="code docutils literal notranslate"><span class="pre">skos:broader</span></code> property of the newly created city instance.</p>
</section>
<section id="streaming-loader-for-spreadsheets">
<h3>Streaming Loader for Spreadsheets<a class="headerlink" href="#streaming-loader-for-spreadsheets" title="Permalink to this headline"></a></h3>
<p>Very large spreadsheets are best imported with a streaming loader, row by row, minimizing memory consumption.
This is an alternative API that is provided for files ending with <code class="code docutils literal notranslate"><span class="pre">.csv</span></code> and <code class="code docutils literal notranslate"><span class="pre">.tsv</span></code> only.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The streaming loader is not available for Excel files.</p>
</div>
<p>The following example illustrates how to use it with a <code class="code docutils literal notranslate"><span class="pre">for...of</span></code> loop in JavaScript.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">let</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">IO</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">asSpreadsheetIterator</span><span class="p">();</span>
<span class="linenos"> 2</span><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">row</span> <span class="k">of</span> <span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos"> 3</span>    <span class="kd">let</span> <span class="nx">city</span> <span class="o">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">createCity</span><span class="p">({</span>
<span class="linenos"> 4</span>        <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://topquadrant.com/ns/examples/geography#&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">City</span><span class="p">),</span>
<span class="linenos"> 5</span>        <span class="nx">prefLabel</span><span class="o">:</span> <span class="nx">row</span><span class="p">.</span><span class="nx">City</span><span class="p">,</span>
<span class="linenos"> 6</span>        <span class="nx">broader</span><span class="o">:</span> <span class="nx">focusNode</span><span class="p">,</span>
<span class="linenos"> 7</span>        <span class="nx">population</span><span class="o">:</span> <span class="nx">row</span><span class="p">.</span><span class="nx">Population</span><span class="p">,</span>
<span class="linenos"> 8</span>        <span class="nx">lat</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">LatLong</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">0</span><span class="p">]),</span>
<span class="linenos"> 9</span>        <span class="kr">long</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">row</span><span class="p">.</span><span class="nx">LatLong</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mf">1</span><span class="p">]),</span>
<span class="linenos">10</span>    <span class="p">})</span>
<span class="linenos">11</span>    <span class="kd">let</span> <span class="nx">maoriName</span> <span class="o">=</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;Maori Name&#39;</span><span class="p">];</span>
<span class="linenos">12</span>    <span class="k">if</span><span class="p">(</span><span class="nx">maoriName</span><span class="p">)</span> <span class="p">{</span>
<span class="linenos">13</span>        <span class="nx">city</span><span class="p">.</span><span class="nx">altLabel</span> <span class="o">=</span> <span class="nx">skosxl</span><span class="p">.</span><span class="nx">createLabel</span><span class="p">({</span>
<span class="linenos">14</span>            <span class="nx">literalForm</span><span class="o">:</span> <span class="nx">graph</span><span class="p">.</span><span class="nx">langString</span><span class="p">(</span><span class="nx">maoriName</span><span class="p">,</span> <span class="s1">&#39;mi&#39;</span><span class="p">)</span>
<span class="linenos">15</span>        <span class="p">})</span>
<span class="linenos">16</span>    <span class="p">}</span>
<span class="linenos">17</span><span class="p">}</span>
</pre></div>
</div>
<p>The result of <code class="code docutils literal notranslate"><span class="pre">asSpreadsheetIterator()</span></code> can also be used as a iterator directly, i.e. calling <code class="code docutils literal notranslate"><span class="pre">next()</span></code> will return an object with the fields done and value.
Each value (row) is a JavaScript object with the column names as field names.
All cell values are strings and may need to be converted downstream in the JavaScript code.
The field <code class="code docutils literal notranslate"><span class="pre">s.columnNames</span></code> can be used to query the names of the columns.</p>
</section>
</section>
<section id="importing-xml">
<span id="scripting-importing-xml"></span><h2>Importing XML<a class="headerlink" href="#importing-xml" title="Permalink to this headline"></a></h2>
<p>For importing XML, we provide a convenient read-only DOM-like API, based on the class <code class="code docutils literal notranslate"><span class="pre">XMLNode</span></code>.
You can fetch an instance of <code class="code docutils literal notranslate"><span class="pre">XMLNode</span></code> using <code class="code docutils literal notranslate"><span class="pre">IO.uploadedFile(file).asXML()</span></code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Use auto-complete on <code class="code docutils literal notranslate"><span class="pre">IO.uploadedFile(file).asXML()</span></code> to see the currently available <code class="code docutils literal notranslate"><span class="pre">XMLNode</span></code> API.</p>
</div>
<p>Let’s assume we have this XML file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="linenos"> 2</span><span class="nt">&lt;catalog&gt;</span>
<span class="linenos"> 3</span>   <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&quot;bk101&quot;</span><span class="nt">&gt;</span>
<span class="linenos"> 4</span>      <span class="nt">&lt;author&gt;</span>Gambardella, Matthew<span class="nt">&lt;/author&gt;</span>
<span class="linenos"> 5</span>      <span class="nt">&lt;title&gt;</span>XML Developer&#39;s Guide<span class="nt">&lt;/title&gt;</span>
<span class="linenos"> 6</span>      <span class="nt">&lt;genre&gt;</span>Computer<span class="nt">&lt;/genre&gt;</span>
<span class="linenos"> 7</span>      <span class="nt">&lt;price&gt;</span>44.95<span class="nt">&lt;/price&gt;</span>
<span class="linenos"> 8</span>      <span class="nt">&lt;publish_date&gt;</span>2000-10-01<span class="nt">&lt;/publish_date&gt;</span>
<span class="linenos"> 9</span>      <span class="nt">&lt;description&gt;</span>An in-depth look at creating applications with XML.<span class="nt">&lt;/description&gt;</span>
<span class="linenos">10</span>   <span class="nt">&lt;/book&gt;</span>
<span class="linenos">11</span>   <span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&quot;bk102&quot;</span><span class="nt">&gt;</span>
<span class="linenos">12</span>      <span class="nt">&lt;author&gt;</span>Ralls, Kim<span class="nt">&lt;/author&gt;</span>
<span class="linenos">13</span>      <span class="nt">&lt;title&gt;</span>Midnight Rain<span class="nt">&lt;/title&gt;</span>
<span class="linenos">14</span>      <span class="nt">&lt;genre&gt;</span>Fantasy<span class="nt">&lt;/genre&gt;</span>
<span class="linenos">15</span>      <span class="nt">&lt;price&gt;</span>5.95<span class="nt">&lt;/price&gt;</span>
<span class="linenos">16</span>      <span class="nt">&lt;publish_date&gt;</span>2000-12-16<span class="nt">&lt;/publish_date&gt;</span>
<span class="linenos">17</span>      <span class="nt">&lt;description&gt;</span>A former architect battles corporate zombies, an evil sorceress, and her own childhood to become queen of the world.<span class="nt">&lt;/description&gt;</span>
<span class="linenos">18</span>   <span class="nt">&lt;/book&gt;</span>
<span class="linenos">19</span><span class="nt">&lt;/catalog&gt;</span>
</pre></div>
</div>
<p>Here are some example queries and their results:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">let</span> <span class="nx">xml</span> <span class="o">=</span> <span class="nx">IO</span><span class="p">.</span><span class="nx">uploadedFile</span><span class="p">(</span><span class="nx">file</span><span class="p">).</span><span class="nx">asXML</span><span class="p">();</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nx">xml</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">;</span> <span class="c1">// &quot;catalog&quot;</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="nx">xml</span><span class="p">.</span><span class="nx">isElement</span><span class="p">();</span> <span class="c1">// true</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="nx">xml</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="c1">// 2</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="nx">xml</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span> <span class="c1">// &quot;bk101&quot;</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="nx">xml</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mf">1</span><span class="p">].</span><span class="nx">childNodes</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">text</span><span class="p">;</span> <span class="c1">// &quot;Ralls, Kim&quot;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="nx">xml</span><span class="p">.</span><span class="nx">xpathNode</span><span class="p">(</span><span class="s1">&#39;book[2]/@id&#39;</span><span class="p">);</span> <span class="c1">// &quot;bk102&quot;</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="nx">xml</span><span class="p">.</span><span class="nx">xpathNodes</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">node</span> <span class="p">=&gt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// [&quot;bk101&quot;,&quot;bk102&quot;]</span>
</pre></div>
</div>
</section>
<section id="importing-relational-databases-via-sql">
<span id="scripting-importing-sql"></span><h2>Importing Relational Databases via SQL<a class="headerlink" href="#importing-relational-databases-via-sql" title="Permalink to this headline"></a></h2>
<p>Importing data from relational databases is covered by <a class="reference internal" href="sql.html#scripting-sql"><span class="std std-ref">Working with Relational Databases via SQL</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ui.html" class="btn btn-neutral float-left" title="The Scripting User Interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sql.html" class="btn btn-neutral float-right" title="Working with Relational Databases via SQL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, TopQuadrant, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>